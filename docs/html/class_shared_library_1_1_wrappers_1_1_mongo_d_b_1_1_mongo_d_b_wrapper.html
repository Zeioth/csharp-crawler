<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Google Play Tools: SharedLibrary.Wrappers.MongoDB.MongoDBWrapper Class Reference</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Google Play Tools </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="wiki.htm"><span>Wiki</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_shared_library.html">SharedLibrary</a></li><li class="navelem"><a class="el" href="namespace_shared_library_1_1_wrappers.html">Wrappers</a></li><li class="navelem"><a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html">MongoDB</a></li><li class="navelem"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html">MongoDBWrapper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Perform <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> operations adapted to our system.  
 <a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a38d77c93b38fe257120387fb64ec6a1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a38d77c93b38fe257120387fb64ec6a1d">ConfigureClient</a> (string username, string password, string authSrc, string serverAddress, int timeout, string databaseName, int maxPoolSize=100)</td></tr>
<tr class="memdesc:a38d77c93b38fe257120387fb64ec6a1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures a client that will be used to connect to <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> on every operation.  <a href="#a38d77c93b38fe257120387fb64ec6a1d">More...</a><br /></td></tr>
<tr class="separator:a38d77c93b38fe257120387fb64ec6a1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae0d9297ce184d5e72366230ff66bd46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#aae0d9297ce184d5e72366230ff66bd46">EnsureIndex</a> (string f1_name, string collectionName, bool f1_isAscending=true, bool isUnique=true)</td></tr>
<tr class="memdesc:aae0d9297ce184d5e72366230ff66bd46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that a collections have an index.  <a href="#aae0d9297ce184d5e72366230ff66bd46">More...</a><br /></td></tr>
<tr class="separator:aae0d9297ce184d5e72366230ff66bd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10756923c5596890cd9b0a376fd15502"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a10756923c5596890cd9b0a376fd15502">EnsureCompoundIndex</a> (string f1_name, string f2_name, string collectionName, bool f1_isAscending=true, bool f2_isAscending=true, bool isUnique=true)</td></tr>
<tr class="memdesc:a10756923c5596890cd9b0a376fd15502"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that a collections have a compound index of two fields.  <a href="#a10756923c5596890cd9b0a376fd15502">More...</a><br /></td></tr>
<tr class="separator:a10756923c5596890cd9b0a376fd15502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3aa6b5a049bb8d200f86227dab3109df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a3aa6b5a049bb8d200f86227dab3109df">EnsureCompoundIndex</a> (string f1_name, string f2_name, string f3_name, string collectionName, bool f1_isAscending=true, bool f2_isAscending=true, bool f3_isAscending=true, bool isUnique=true)</td></tr>
<tr class="memdesc:a3aa6b5a049bb8d200f86227dab3109df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that a collections have a compound index of three fields.  <a href="#a3aa6b5a049bb8d200f86227dab3109df">More...</a><br /></td></tr>
<tr class="separator:a3aa6b5a049bb8d200f86227dab3109df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9efab6496c9a245f3b85fa6cb7e3385b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a9efab6496c9a245f3b85fa6cb7e3385b">FindOneAndDelete</a> (string lookForField, string withValue, string collectionName)</td></tr>
<tr class="memdesc:a9efab6496c9a245f3b85fa6cb7e3385b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the received document from the collection and returns it. This operation is performed atomically.  <a href="#a9efab6496c9a245f3b85fa6cb7e3385b">More...</a><br /></td></tr>
<tr class="separator:a9efab6496c9a245f3b85fa6cb7e3385b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0bc39024902aad8a088397b76a45a84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a> (IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</td></tr>
<tr class="memdesc:ad0bc39024902aad8a088397b76a45a84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts a bulk of elements to the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a>. The type T must match the type of the target collection  <a href="#ad0bc39024902aad8a088397b76a45a84">More...</a><br /></td></tr>
<tr class="separator:ad0bc39024902aad8a088397b76a45a84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a817387e1a61f412e61dd7ca4aa98eb1e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a817387e1a61f412e61dd7ca4aa98eb1e">ClearCollection</a> (string lookForField, string withValue, string collectionName, bool onlyToday=true, string dateField=&quot;_id&quot;, DateType dateType=<a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">DateType.ObjectId</a>)</td></tr>
<tr class="memdesc:a817387e1a61f412e61dd7ca4aa98eb1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes all documents from the collection. Only from today if onlyToday is true. This overload uses one filter.  <a href="#a817387e1a61f412e61dd7ca4aa98eb1e">More...</a><br /></td></tr>
<tr class="separator:a817387e1a61f412e61dd7ca4aa98eb1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac356e503b3c6ddc1a21e4c1823e898b3"><td class="memItemLeft" align="right" valign="top">async void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ac356e503b3c6ddc1a21e4c1823e898b3">DeleteOneAsync</a> (string lookForField, string withValue, string collectionName)</td></tr>
<tr class="memdesc:ac356e503b3c6ddc1a21e4c1823e898b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the received document from the collection. This operation is performed atomically.  <a href="#ac356e503b3c6ddc1a21e4c1823e898b3">More...</a><br /></td></tr>
<tr class="separator:ac356e503b3c6ddc1a21e4c1823e898b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47ef87ad5e46c79cb7a2c927fa213f42"><td class="memItemLeft" align="right" valign="top">async void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a47ef87ad5e46c79cb7a2c927fa213f42">InsertManyAsync</a> (IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</td></tr>
<tr class="memdesc:a47ef87ad5e46c79cb7a2c927fa213f42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inserts a bulk of elements to the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a>. The type T must match the type of the target collection  <a href="#a47ef87ad5e46c79cb7a2c927fa213f42">More...</a><br /></td></tr>
<tr class="separator:a47ef87ad5e46c79cb7a2c927fa213f42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a985e629aa5e78bebfdfd2b01be401c8b"><td class="memItemLeft" align="right" valign="top">async void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a985e629aa5e78bebfdfd2b01be401c8b">DeleteManyAsync</a> (IEnumerable records, string collectionName)</td></tr>
<tr class="memdesc:a985e629aa5e78bebfdfd2b01be401c8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">It recieves a list of objects, convert to BsonDocument, and then delete them from DB looking for _id field.  <a href="#a985e629aa5e78bebfdfd2b01be401c8b">More...</a><br /></td></tr>
<tr class="separator:a985e629aa5e78bebfdfd2b01be401c8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1562cc71ba63eca9c78d0ca470e294e"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ac1562cc71ba63eca9c78d0ca470e294e">GetFromQueue</a> (string collectionName)</td></tr>
<tr class="memdesc:ac1562cc71ba63eca9c78d0ca470e294e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds an element that is "Not Busy" and modifies it's status. to "Busy" atomically so that no other worker will try to process it on the same time.  <a href="#ac1562cc71ba63eca9c78d0ca470e294e">More...</a><br /></td></tr>
<tr class="separator:ac1562cc71ba63eca9c78d0ca470e294e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838c20ea897a9e49a8ea2223b3679628"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a838c20ea897a9e49a8ea2223b3679628">UpdateTopFlags</a> (string country, List&lt; string &gt; records, List&lt; int &gt; appsRankPos, string updateField, string collectionName, bool isUpsert=true)</td></tr>
<tr class="memdesc:a838c20ea897a9e49a8ea2223b3679628"><td class="mdescLeft">&#160;</td><td class="mdescRight">It performs many updateOne operations in bulk, to update the flags of a top ranking numerating them by order.  <a href="#a838c20ea897a9e49a8ea2223b3679628">More...</a><br /></td></tr>
<tr class="separator:a838c20ea897a9e49a8ea2223b3679628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4678e5fc42ebc9b990246e91f49feef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#aa4678e5fc42ebc9b990246e91f49feef">IsValidCategory</a> (string _id, List&lt; string &gt; list)</td></tr>
<tr class="memdesc:aa4678e5fc42ebc9b990246e91f49feef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks in <a class="el" href="class_shared_library_1_1_constants.html#ac54a8c980d1430da3ad0d130cce33fc1">Constants.APPS_DATA_COLLECTION</a> if the category of the app corresponds to any item in <a class="el" href="class_shared_library_1_1_constants.html#a36cbb11c3cfa4977eac018fc04aa974d">Constants.VALID_CATEGORIES</a>.  <a href="#aa4678e5fc42ebc9b990246e91f49feef">More...</a><br /></td></tr>
<tr class="separator:aa4678e5fc42ebc9b990246e91f49feef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a767610cfcffc13d0c1fb574326e800d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a767610cfcffc13d0c1fb574326e800d1">PopulateDailyScraperQueue</a> ()</td></tr>
<tr class="memdesc:a767610cfcffc13d0c1fb574326e800d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">BUG: Right now the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> drivers doesn't support auto pooling, so it will result in exceptions if maxpoolsize is exceeded. This is dangerous because our collection size is not fixed. We can use async when they fix it. So i'll leave this method here as example. The adventage of doing this async is that the operations will not lock the db for the rest of users. More info: <a href="https://jira.mongodb.org/browse/CSHARP-1180">https://jira.mongodb.org/browse/CSHARP-1180</a>  <a href="#a767610cfcffc13d0c1fb574326e800d1">More...</a><br /></td></tr>
<tr class="separator:a767610cfcffc13d0c1fb574326e800d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a184e67222e5ae0501cb3f8338e8e0676"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a184e67222e5ae0501cb3f8338e8e0676">PopulateHPDailyScraperQueue</a> ()</td></tr>
<tr class="memdesc:a184e67222e5ae0501cb3f8338e8e0676"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare the queue for DailyScrapper when client is running in hp-mode. This method can run more than once per day.  <a href="#a184e67222e5ae0501cb3f8338e8e0676">More...</a><br /></td></tr>
<tr class="separator:a184e67222e5ae0501cb3f8338e8e0676"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9e4883a361fb482a04cd6c389a5e7f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#af9e4883a361fb482a04cd6c389a5e7f9">PopulateAppsUpdaterQueue</a> ()</td></tr>
<tr class="memdesc:af9e4883a361fb482a04cd6c389a5e7f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare the queue for AppsUpdater. This method should run once per day.  <a href="#af9e4883a361fb482a04cd6c389a5e7f9">More...</a><br /></td></tr>
<tr class="separator:af9e4883a361fb482a04cd6c389a5e7f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569fb0aa7d0cfcfc61426377615d0600"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a569fb0aa7d0cfcfc61426377615d0600">PopulateQueuedForClean</a> ()</td></tr>
<tr class="memdesc:a569fb0aa7d0cfcfc61426377615d0600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare the queue for AppsCleaner. This method should run once per day.  <a href="#a569fb0aa7d0cfcfc61426377615d0600">More...</a><br /></td></tr>
<tr class="separator:a569fb0aa7d0cfcfc61426377615d0600"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:acdec2ef988eddf8df22445e3df2aa2dd"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#acdec2ef988eddf8df22445e3df2aa2dd">connString</a></td></tr>
<tr class="separator:acdec2ef988eddf8df22445e3df2aa2dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f049b230d7cd97190404ea3d29c46b"><td class="memItemLeft" align="right" valign="top">MongoClient&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a04f049b230d7cd97190404ea3d29c46b">mongoClient</a></td></tr>
<tr class="separator:a04f049b230d7cd97190404ea3d29c46b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7206c640ac6ddd1b7d021c128c2d97cd"><td class="memItemLeft" align="right" valign="top">IMongoDatabase&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a></td></tr>
<tr class="separator:a7206c640ac6ddd1b7d021c128c2d97cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1177a86b12c89bdfa8999ed40181f502"><td class="memItemLeft" align="right" valign="top">readonly Logger&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a> = LogManager.GetCurrentClassLogger ()</td></tr>
<tr class="separator:a1177a86b12c89bdfa8999ed40181f502"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Perform <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> operations adapted to our system. </p>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00021">21</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a817387e1a61f412e61dd7ca4aa98eb1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.ClearCollection </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>lookForField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>withValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>onlyToday</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>dateField</em> = <code>&quot;_id&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">DateType</a>&#160;</td>
          <td class="paramname"><em>dateType</em> = <code><a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">DateType.ObjectId</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes all documents from the collection. Only from today if onlyToday is true. This overload uses one filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">collectionName</td><td>collection from where we remove the document.</td></tr>
    <tr><td class="paramname">lookForField</td><td>Field to filter.</td></tr>
    <tr><td class="paramname">withValue</td><td>Value to filter.</td></tr>
    <tr><td class="paramname">onlyToday</td><td>If True, only documents from today are deleted. It uses dateField to check.</td></tr>
    <tr><td class="paramname">dateField</td><td>Only used if onlyToday is true. Must be an ObjectId or DateTime field.</td></tr>
    <tr><td class="paramname">dateType</td><td>Only used if onlyToday is true. Must be set to "ObjectId" or "DateTime" value.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00322">322</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            FilterDefinition&lt;BsonDocument&gt; filter = null;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            var builder           = Builders&lt;BsonDocument&gt;.Filter;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            var collection        = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                                         (collectionName);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            var mongoQuery        = Query.Empty;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordtype">bool</span> connectionError  = <span class="keyword">false</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordtype">int</span> nConnectionError  = 0;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <span class="comment">// It&#39;s a DateTime dateField? -&gt; Filter</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    <span class="keywordflow">if</span> (dateType == <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">DateType</a>.DateTime)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        filter = (</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                            builder.Eq (lookForField, withValue) &amp;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                               (builder.Gte(dateField, <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.Today.ToUniversalTime()) &amp; </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                               builder.Lt(dateField, <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.Today.AddDays(1).ToUniversalTime()))</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        );</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    </div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    <span class="comment">// It&#39;s an ObjectId dateField? -&gt; Filter</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    <span class="keywordflow">if</span> (dateType == <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">DateType</a>.ObjectId)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                        filter = (</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                            builder.Eq (lookForField, withValue) &amp;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                (builder.Gte(dateField, <span class="keyword">new</span> <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">ObjectId</a> (<a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.Today.ToUniversalTime(),0,0,0)) &amp; </div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                builder.Lt(dateField, <span class="keyword">new</span> <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">ObjectId</a> (<a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.Today.AddDays(1).ToUniversalTime(),0,0,0)))</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        );</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    <span class="comment">// If type is unknow, throw exception.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                    <span class="keywordflow">if</span> (dateType != <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">DateType</a>.ObjectId &amp;&amp; dateType != <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">DateType</a>.DateTime)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;dateType parameter must be &quot;</span> +</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                            <span class="stringliteral">&quot;ObjectId or DateTime.&quot;</span>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    <span class="comment">// Delete</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    <span class="keywordflow">if</span> (onlyToday) collection</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                            .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                            .DeleteMany(filter);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <span class="keywordflow">if</span> (!onlyToday) collection</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        .DeleteMany(<span class="keyword">new</span> BsonDocument()); <span class="comment">// &lt;- This means, delete all</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                } </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    {</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                } </div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Dummy return for compiler</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        }</div><div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">SharedLibrary.Wrappers.MongoDB.DateType.ObjectId</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93">SharedLibrary.Wrappers.MongoDB.DateType</a></div><div class="ttdeci">DateType</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00016">MongoDBWrapper.cs:16</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">SharedLibrary.Wrappers.MongoDB.DateType.DateTime</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a817387e1a61f412e61dd7ca4aa98eb1e_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a817387e1a61f412e61dd7ca4aa98eb1e_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a817387e1a61f412e61dd7ca4aa98eb1e_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a817387e1a61f412e61dd7ca4aa98eb1e_cgraph">
<area shape="rect" id="node2" href="class_shared_library_1_1_exception_callback.html#aac4c08013df130611a62a19c6233003d" title="It Sends an email to the administrator. " alt="" coords="299,5,517,47"/>
<area shape="rect" id="node3" href="class_shared_library_1_1_wrappers_1_1_email_management_1_1_s_m_t_p.html#ab395843cd4b16b53dcb464fce27c0b95" title="Send an email from bypassing SSL security. Only for testing pourposes. " alt="" coords="565,5,856,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a38d77c93b38fe257120387fb64ec6a1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.ConfigureClient </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>authSrc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>serverAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>databaseName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxPoolSize</em> = <code>100</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures a client that will be used to connect to <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> on every operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">username</td><td>Username</td></tr>
    <tr><td class="paramname">password</td><td>User Password</td></tr>
    <tr><td class="paramname">authSrc</td><td>Database used as Authentication Provider. Default is 'admin'</td></tr>
    <tr><td class="paramname">serverAddress</td><td>IP Address of the DB Server. Format = ip:port</td></tr>
    <tr><td class="paramname">timeout</td><td>Connection Timeout</td></tr>
    <tr><td class="paramname">databaseName</td><td>Database Name</td></tr>
    <tr><td class="paramname">maxPoolSize</td><td>Max number of concurrent connections. Careful: MongoDb will create a thread for each connection.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00045">45</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <span class="comment">// Reading App Config for config data</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#acdec2ef988eddf8df22445e3df2aa2dd">connString</a>  = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers.html">MongoHelpers</a>.<a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers.html#a58bcde2d092cf7d2ebf5a28385eef1b2">BuildConnectionString</a> (username,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                password, authSrc, <span class="keyword">true</span>, <span class="keyword">false</span>, serverAddress, timeout, timeout, </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                maxPoolSize);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a04f049b230d7cd97190404ea3d29c46b">mongoClient</a> = <span class="keyword">new</span> MongoClient(<a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#acdec2ef988eddf8df22445e3df2aa2dd">connString</a>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>          = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a04f049b230d7cd97190404ea3d29c46b">mongoClient</a>.GetDatabase (databaseName);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers_html_a58bcde2d092cf7d2ebf5a28385eef1b2"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers.html#a58bcde2d092cf7d2ebf5a28385eef1b2">SharedLibrary.Wrappers.MongoExtensions.MongoHelpers.BuildConnectionString</a></div><div class="ttdeci">static string BuildConnectionString(string login, string password, string authSrc, bool safeMode, bool readOnSecondary, string addresses, int connectionTimeoutMilliseconds, int socketTimeoutMilliseconds, int maxPoolingSize, IEnumerable&lt; string &gt; readPreferenceTags=null)</div><div class="ttdoc">Builds the connection string. </div><div class="ttdef"><b>Definition:</b> <a href="_mongo_extensions_8cs_source.html#l00027">MongoExtensions.cs:27</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_acdec2ef988eddf8df22445e3df2aa2dd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#acdec2ef988eddf8df22445e3df2aa2dd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.connString</a></div><div class="ttdeci">string connString</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00024">MongoDBWrapper.cs:24</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a04f049b230d7cd97190404ea3d29c46b"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a04f049b230d7cd97190404ea3d29c46b">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.mongoClient</a></div><div class="ttdeci">MongoClient mongoClient</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00025">MongoDBWrapper.cs:25</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers_html"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_extensions_1_1_mongo_helpers.html">SharedLibrary.Wrappers.MongoExtensions.MongoHelpers</a></div><div class="ttdoc">Methods to reduce verbosity. </div><div class="ttdef"><b>Definition:</b> <a href="_mongo_extensions_8cs_source.html#l00012">MongoExtensions.cs:12</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a38d77c93b38fe257120387fb64ec6a1d_icgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a38d77c93b38fe257120387fb64ec6a1d_icgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a38d77c93b38fe257120387fb64ec6a1d_icgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a38d77c93b38fe257120387fb64ec6a1d_icgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a985e629aa5e78bebfdfd2b01be401c8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.DeleteManyAsync </td>
          <td>(</td>
          <td class="paramtype">IEnumerable&#160;</td>
          <td class="paramname"><em>records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It recieves a list of objects, convert to BsonDocument, and then delete them from DB looking for _id field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">records</td><td>Records.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection name.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00558">558</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordtype">bool</span> connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordtype">int</span> nConnectionError = 0;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            FilterDefinition&lt;BsonDocument&gt; filter = null;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            List&lt;string&gt; idList = <span class="keyword">new</span> List&lt;string&gt; ();</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    <span class="comment">// Create a list with all the ids of the records.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                    <span class="keywordflow">foreach</span>(BsonDocument record <span class="keywordflow">in</span> records.ToBsonList())</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                        idList.Add(record[<span class="stringliteral">&quot;_id&quot;</span>].ToString());</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    filter = Builders&lt;BsonDocument&gt;.Filter.In(<span class="stringliteral">&quot;_id&quot;</span>, idList);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="comment">// Perform deleteManyAsync</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    await <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    .DeleteManyAsync(filter);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    </div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                } </div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                    }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e.Message);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a985e629aa5e78bebfdfd2b01be401c8b_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a985e629aa5e78bebfdfd2b01be401c8b_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a985e629aa5e78bebfdfd2b01be401c8b_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a985e629aa5e78bebfdfd2b01be401c8b_cgraph">
<area shape="rect" id="node2" href="class_shared_library_1_1_exception_callback.html#aac4c08013df130611a62a19c6233003d" title="It Sends an email to the administrator. " alt="" coords="316,5,535,47"/>
<area shape="rect" id="node3" href="class_shared_library_1_1_wrappers_1_1_email_management_1_1_s_m_t_p.html#ab395843cd4b16b53dcb464fce27c0b95" title="Send an email from bypassing SSL security. Only for testing pourposes. " alt="" coords="583,5,873,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac356e503b3c6ddc1a21e4c1823e898b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.DeleteOneAsync </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>lookForField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>withValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes the received document from the collection. This operation is performed atomically. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lookForField</td><td>Field we are looking for.</td></tr>
    <tr><td class="paramname">withValue</td><td>Value we are looking for in the selected field.</td></tr>
    <tr><td class="paramname">collectionName</td><td>collection from where we remove the document.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00411">411</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            var collection        = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                (collectionName);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            var filter            = <span class="keyword">new</span> BsonDocument(lookForField, withValue);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordtype">bool</span> connectionError  = <span class="keyword">false</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordtype">int</span> nConnectionError  = 0;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    await collection</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                        .DeleteOneAsync (filter);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                } </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                    {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                } </div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a10756923c5596890cd9b0a376fd15502"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.EnsureCompoundIndex </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f1_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f2_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f1_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f2_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isUnique</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensures that a collections have a compound index of two fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f1_name</td><td>Field to be used as first part of the index.</td></tr>
    <tr><td class="paramname">f2_name</td><td>Field to be used as second part of the index.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection to apply this index.</td></tr>
    <tr><td class="paramname">f1_isAscending</td><td>Index direction of the field 1.</td></tr>
    <tr><td class="paramname">f2_isAscending</td><td>Index direction of the field 2.</td></tr>
    <tr><td class="paramname">isUnique</td><td>If set to <code>true</code> set unique.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00094">94</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            var collection = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            BsonDocument f1_key;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            BsonDocument f2_key;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            IndexKeysDefinition&lt;BsonDocument&gt; keys;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            CreateIndexOptions options = <span class="keyword">new</span> CreateIndexOptions();</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="comment">// Set keys</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">if</span> (f1_isAscending) f1_key = (<span class="keyword">new</span> BsonDocument (f1_name,  1));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">else</span>                f1_key = (<span class="keyword">new</span> BsonDocument (f1_name, -1));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">if</span> (f2_isAscending) f2_key = (<span class="keyword">new</span> BsonDocument (f2_name,  1));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">else</span>                f2_key = (<span class="keyword">new</span> BsonDocument (f2_name, -1));</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            keys = Builders&lt;BsonDocument&gt;.IndexKeys.Combine(f1_key, f2_key);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="comment">// Set options</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">if</span> (isUnique) options.Unique = <span class="keyword">true</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">else</span>           options.Unique = <span class="keyword">false</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="comment">// Create index</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            collection.Indexes.CreateOne(keys, options);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a10756923c5596890cd9b0a376fd15502_icgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a10756923c5596890cd9b0a376fd15502_icgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a10756923c5596890cd9b0a376fd15502_icgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a10756923c5596890cd9b0a376fd15502_icgraph">
<area shape="rect" id="node2" href="class_daily_scraper_1_1_daily_scraper.html#a946550ae53f1d51c216c87b073e702cc" title="DailyScraper.DailyScraper.Main" alt="" coords="345,13,553,39"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3aa6b5a049bb8d200f86227dab3109df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.EnsureCompoundIndex </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f1_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f2_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f3_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f1_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f2_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f3_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isUnique</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensures that a collections have a compound index of three fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f1_name</td><td>Field to be used as first part of the index.</td></tr>
    <tr><td class="paramname">f2_name</td><td>Field to be used as second part of the index.</td></tr>
    <tr><td class="paramname">f3_name</td><td>Field to be used as third part of the index.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection to apply this index.</td></tr>
    <tr><td class="paramname">f1_isAscending</td><td>Index direction of the field 1.</td></tr>
    <tr><td class="paramname">f2_isAscending</td><td>Index direction of the field 2.</td></tr>
    <tr><td class="paramname">f3_isAscending</td><td>Index direction of the field 3.</td></tr>
    <tr><td class="paramname">isUnique</td><td>If set to <code>true</code> set unique.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00130">130</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            var collection = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            BsonDocument f1_key;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            BsonDocument f2_key;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            BsonDocument f3_key;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            IndexKeysDefinition&lt;BsonDocument&gt; keys;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            CreateIndexOptions options = <span class="keyword">new</span> CreateIndexOptions();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="comment">// Set keys</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> (f1_isAscending) f1_key = (<span class="keyword">new</span> BsonDocument (f1_name,  1));</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">else</span>                f1_key = (<span class="keyword">new</span> BsonDocument (f1_name, -1));</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">if</span> (f2_isAscending) f2_key = (<span class="keyword">new</span> BsonDocument (f2_name,  1));</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">else</span>                f2_key = (<span class="keyword">new</span> BsonDocument (f2_name, -1));</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordflow">if</span> (f3_isAscending) f3_key = (<span class="keyword">new</span> BsonDocument (f3_name,  1));</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">else</span>                f3_key = (<span class="keyword">new</span> BsonDocument (f3_name, -1));</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            keys = Builders&lt;BsonDocument&gt;.IndexKeys.Combine(f1_key, f2_key, f3_key);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment">// Set options</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">if</span> (isUnique) options.Unique = <span class="keyword">true</span>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">else</span>          options.Unique = <span class="keyword">false</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="comment">// Create index</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            collection.Indexes.CreateOne(keys, options);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a3aa6b5a049bb8d200f86227dab3109df_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a3aa6b5a049bb8d200f86227dab3109df_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a3aa6b5a049bb8d200f86227dab3109df_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a3aa6b5a049bb8d200f86227dab3109df_cgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aae0d9297ce184d5e72366230ff66bd46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.EnsureIndex </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>f1_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>f1_isAscending</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isUnique</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensures that a collections have an index. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f1_name</td><td>Field to be used as index.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection to apply this index.</td></tr>
    <tr><td class="paramname">f1_isAscending</td><td>Index direction of the field 1.</td></tr>
    <tr><td class="paramname">isUnique</td><td>If set to <code>true</code> set unique.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00064">64</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            var collection = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            BsonDocument f1_key;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            IndexKeysDefinition&lt;BsonDocument&gt; keys;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            CreateIndexOptions options = <span class="keyword">new</span> CreateIndexOptions();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="comment">// Set keys</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordflow">if</span> (f1_isAscending) f1_key = (<span class="keyword">new</span> BsonDocument (f1_name,  1));</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">else</span>                f1_key = (<span class="keyword">new</span> BsonDocument (f1_name, -1));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            keys = Builders&lt;BsonDocument&gt;.IndexKeys.Combine(f1_key);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="comment">// Set options</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">if</span> (isUnique) options.Unique = <span class="keyword">true</span>;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keywordflow">else</span>           options.Unique = <span class="keyword">false</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="comment">// Create index</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            collection.Indexes.CreateOne(keys, options);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aae0d9297ce184d5e72366230ff66bd46_icgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aae0d9297ce184d5e72366230ff66bd46_icgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aae0d9297ce184d5e72366230ff66bd46_icgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aae0d9297ce184d5e72366230ff66bd46_icgraph">
<area shape="rect" id="node2" href="class_apps_cleaner_1_1_apps_cleaner.html#a6f1acdc00d7d4514bb74ad3dd557f1b7" title="AppsCleaner.AppsCleaner.Main" alt="" coords="284,5,492,32"/>
<area shape="rect" id="node3" href="class_apps_updater_1_1_apps_updater.html#aed71495f64f6bcfbe344ee11b3cb7c4b" title="AppsUpdater.AppsUpdater.Main" alt="" coords="283,56,493,83"/>
<area shape="rect" id="node4" href="class_daily_scraper_1_1_daily_scraper.html#a946550ae53f1d51c216c87b073e702cc" title="DailyScraper.DailyScraper.Main" alt="" coords="284,107,492,133"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9efab6496c9a245f3b85fa6cb7e3385b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.FindOneAndDelete </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>lookForField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>withValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes the received document from the collection and returns it. This operation is performed atomically. </p>
<dl class="section return"><dt>Returns</dt><dd>The deleted object.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lookForField</td><td>Field we are looking for.</td></tr>
    <tr><td class="paramname">withValue</td><td>Value we are looking for in the selected field.</td></tr>
    <tr><td class="paramname">collectionName</td><td>collection from where we remove the document.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00168">168</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            var collection        = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                                         (collectionName);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            var filter            = <span class="keyword">new</span> BsonDocument(lookForField, withValue);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordtype">bool</span> connectionError  = <span class="keyword">false</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordtype">int</span> nConnectionError  = 0;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    collection</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                        .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                        .FindOneAndDelete (filter);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                } </div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                          e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                          e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                } </div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Dummy return for compiler</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac1562cc71ba63eca9c78d0ca470e294e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.GetFromQueue </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds an element that is "Not Busy" and modifies it's status. to "Busy" atomically so that no other worker will try to process it on the same time. </p>
<p>Actually this is just an alias for FindAndDeleteOne. It does nothing special. </p>
<dl class="section return"><dt>Returns</dt><dd>A string with de id of the unqueued app. Or null if there's no more apps to unqueue.</dd></dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00627">627</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a> response = null;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            FindOneAndDeleteOptions&lt;QueuedApp&gt; options = </div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                <span class="keyword">new</span> FindOneAndDeleteOptions&lt;QueuedApp&gt;();</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordtype">bool</span> connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordtype">int</span> nConnectionError = 0;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="keywordflow">do</span> </div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                { </div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    <span class="comment">// Set options</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    options.Projection = Builders&lt;QueuedApp&gt;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        .Projection.Include(<span class="stringliteral">&quot;_id&quot;</span>);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    <span class="comment">// Find one and update</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    response = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>&gt;(</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        collectionName)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        .FindOneAndDelete(<span class="keyword">new</span> BsonDocument(),options);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                    <span class="keywordflow">if</span> (response == null) <span class="keywordflow">return</span> null;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                } </div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    Thread.Sleep(Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;= </div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                        ExceptionCallback.SendError(</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                } </div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="keywordflow">catch</span> (Exception e)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                    <span class="keywordflow">return</span> null; <span class="comment">// Dummy return for compiler</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="keywordflow">return</span> response.<a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html#aeb14dcac1dc068920c78d4bfdd043089">_id</a>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html_aeb14dcac1dc068920c78d4bfdd043089"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html#aeb14dcac1dc068920c78d4bfdd043089">SharedLibrary.Models.QueuedApp._id</a></div><div class="ttdeci">string _id</div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00012">QueuedApp.cs:12</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html">SharedLibrary.Models.QueuedApp</a></div><div class="ttdoc">A queued app, waiting to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00009">QueuedApp.cs:9</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad0bc39024902aad8a088397b76a45a84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertMany </td>
          <td>(</td>
          <td class="paramtype">IEnumerable&#160;</td>
          <td class="paramname"><em>records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ignoreDupKeys</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>replace</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts a bulk of elements to the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a>. The type T must match the type of the target collection </p>
<dl class="section return"><dt>Returns</dt><dd>True if ok, False otherway.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">records</td><td>IEnumerable of records. Indented collections are not supported.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection name.</td></tr>
    <tr><td class="paramname">ignoreDupKeys</td><td>If True, duplicate keys will be ignored. <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">replace</td><td>If true, documents with duplicate _id key will be replaced. Exceptions are ignored, but operations are unordered.</td></tr>
  </table>
  </dd>
</dl>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00232">232</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordtype">bool</span> connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordtype">int</span> nConnectionError = 0;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            WriteConcern wc = WriteConcern.Acknowledged;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            InsertManyOptions options = <span class="keyword">new</span> InsertManyOptions();</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            FilterDefinition&lt;BsonDocument&gt; filter = null;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            BulkWriteOptions bulkOptions = <span class="keyword">new</span> BulkWriteOptions ();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            var bulkOps = <span class="keyword">new</span> List&lt;WriteModel&lt;BsonDocument&gt;&gt;();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="keywordflow">if</span> (replace)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        <span class="comment">// Perform replaceOneAsync bulk operations</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <span class="keywordflow">foreach</span>(BsonDocument record <span class="keywordflow">in</span> records.ToBsonList())</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            <span class="comment">// Filter</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                            filter = <span class="keyword">new</span> BsonDocument(<span class="stringliteral">&quot;_id&quot;</span>, record[<span class="stringliteral">&quot;_id&quot;</span>]);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                            <span class="comment">// Add bulk operations</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                            bulkOps.Add(<span class="keyword">new</span> ReplaceOneModel&lt;BsonDocument&gt;(</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                filter, record) { IsUpsert = <span class="keyword">true</span> });</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        <span class="comment">// Execute</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        options.IsOrdered = <span class="keyword">false</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        wc = WriteConcern.Acknowledged;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                            .WithWriteConcern(wc)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            .BulkWrite(bulkOps, bulkOptions);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        <span class="comment">// Perform insertManyAsync</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <span class="keywordflow">if</span> (ignoreDupKeys) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                            options.IsOrdered = <span class="keyword">false</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                            wc = WriteConcern.Unacknowledged;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                            .WithWriteConcern(wc)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                            .InsertMany(records.ToBsonList(), options);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                } </div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e.Message);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_ad0bc39024902aad8a088397b76a45a84_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_ad0bc39024902aad8a088397b76a45a84_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_ad0bc39024902aad8a088397b76a45a84_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_ad0bc39024902aad8a088397b76a45a84_cgraph">
<area shape="rect" id="node2" href="class_shared_library_1_1_exception_callback.html#aac4c08013df130611a62a19c6233003d" title="It Sends an email to the administrator. " alt="" coords="275,5,493,47"/>
<area shape="rect" id="node3" href="class_shared_library_1_1_wrappers_1_1_email_management_1_1_s_m_t_p.html#ab395843cd4b16b53dcb464fce27c0b95" title="Send an email from bypassing SSL security. Only for testing pourposes. " alt="" coords="541,5,832,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a47ef87ad5e46c79cb7a2c927fa213f42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">async void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertManyAsync </td>
          <td>(</td>
          <td class="paramtype">IEnumerable&#160;</td>
          <td class="paramname"><em>records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ignoreDupKeys</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>replace</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inserts a bulk of elements to the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a>. The type T must match the type of the target collection </p>
<dl class="section return"><dt>Returns</dt><dd>True if ok, False otherway.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">records</td><td>IEnumerable of records. Indented collections are not supported.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection name.</td></tr>
    <tr><td class="paramname">ignoreDupKeys</td><td>If True, duplicate keys will be ignored. <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">replace</td><td>If true, documents with duplicate _id key will be replaced. Exceptions are ignored, but operations are unordered.</td></tr>
  </table>
  </dd>
</dl>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00472">472</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordtype">bool</span> connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="keywordtype">int</span> nConnectionError = 0;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            WriteConcern wc = WriteConcern.Acknowledged;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            InsertManyOptions options = <span class="keyword">new</span> InsertManyOptions();</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            FilterDefinition&lt;BsonDocument&gt; filter = null;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            BulkWriteOptions bulkOptions = <span class="keyword">new</span> BulkWriteOptions ();</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            var bulkOps = <span class="keyword">new</span> List&lt;WriteModel&lt;BsonDocument&gt;&gt;();</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">do</span> {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">try</span> </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                    <span class="keywordflow">if</span> (replace)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                        <span class="comment">// Perform replaceOneAsync bulk operations</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                        <span class="keywordflow">foreach</span>(BsonDocument record <span class="keywordflow">in</span> records.ToBsonList())</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                            <span class="comment">// Filter</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                            filter = <span class="keyword">new</span> BsonDocument(<span class="stringliteral">&quot;_id&quot;</span>, record[<span class="stringliteral">&quot;_id&quot;</span>]);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                            <span class="comment">// Add bulk operations</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                            bulkOps.Add(<span class="keyword">new</span> ReplaceOneModel&lt;BsonDocument&gt;(</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                                filter, record) { IsUpsert = <span class="keyword">true</span> });</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                        }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                        <span class="comment">// Execute</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                        options.IsOrdered = <span class="keyword">false</span>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                        wc = WriteConcern.Acknowledged;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        await <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                            .WithWriteConcern(wc)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                            .BulkWriteAsync(bulkOps, bulkOptions);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                        <span class="comment">// Perform insertManyAsync</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                        <span class="keywordflow">if</span> (ignoreDupKeys) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                            options.IsOrdered = <span class="keyword">false</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                            wc = WriteConcern.Unacknowledged;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                        }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                        await <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;(collectionName)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                            .WithWriteConcern(wc)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            .InsertManyAsync(records.ToBsonList(), options);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                } </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                    {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                <span class="keywordflow">catch</span> (Exception e) </div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (Constants.MONGODB_UNEXPECTED_ERROR + e.Message);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    Environment.Exit (0);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            } <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        }</div><div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a47ef87ad5e46c79cb7a2c927fa213f42_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a47ef87ad5e46c79cb7a2c927fa213f42_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a47ef87ad5e46c79cb7a2c927fa213f42_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a47ef87ad5e46c79cb7a2c927fa213f42_cgraph">
<area shape="rect" id="node2" href="class_shared_library_1_1_exception_callback.html#aac4c08013df130611a62a19c6233003d" title="It Sends an email to the administrator. " alt="" coords="312,5,531,47"/>
<area shape="rect" id="node3" href="class_shared_library_1_1_wrappers_1_1_email_management_1_1_s_m_t_p.html#ab395843cd4b16b53dcb464fce27c0b95" title="Send an email from bypassing SSL security. Only for testing pourposes. " alt="" coords="579,5,869,47"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa4678e5fc42ebc9b990246e91f49feef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.IsValidCategory </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">List&lt; string &gt;&#160;</td>
          <td class="paramname"><em>list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks in <a class="el" href="class_shared_library_1_1_constants.html#ac54a8c980d1430da3ad0d130cce33fc1">Constants.APPS_DATA_COLLECTION</a> if the category of the app corresponds to any item in <a class="el" href="class_shared_library_1_1_constants.html#a36cbb11c3cfa4977eac018fc04aa974d">Constants.VALID_CATEGORIES</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">_id</td><td>Id of the app.</td></tr>
    <tr><td class="paramname">list</td><td>List of what is valid.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the app category exists in the list. False otherway.</dd></dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00787">787</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="preprocessor">            #region REGION: PRECONDITIONS</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordflow">if</span> (list == null) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// ALL ARE PARSED? THEN DON&#39;T CHECK</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            var builder    = Builders&lt;BsonDocument&gt;.Filter;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            var collection = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                (Constants.APPS_DATA_COLLECTION);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            var filter     = builder.Eq(<span class="stringliteral">&quot;_id&quot;</span>, _id) &amp; builder.In(<span class="stringliteral">&quot;cat&quot;</span>, list);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            BsonDocument response;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordtype">bool</span> isValid;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="keywordflow">try</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor">                #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                response = collection.Find (filter)</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                    .Project(<span class="keyword">new</span> ProjectionDefinitionBuilder&lt;BsonDocument&gt;()</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                        .Include(<span class="stringliteral">&quot;cat&quot;</span>)).FirstOrDefault();</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="preprocessor">                #endregion</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                isValid = (list != null || list.Any() || response != null);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <span class="keywordflow">if</span> (isValid) </div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            <span class="keywordflow">catch</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="comment">/* Any error? -&gt; return false. Any posterior</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">                 * read/writing attempt will handle the error. */</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aa4678e5fc42ebc9b990246e91f49feef_icgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aa4678e5fc42ebc9b990246e91f49feef_icgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aa4678e5fc42ebc9b990246e91f49feef_icgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_aa4678e5fc42ebc9b990246e91f49feef_icgraph">
<area shape="rect" id="node2" href="class_unit_testing_1_1_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_test_mongo_d_b_wrapper.html#a5fff759b6ff377e315f949fc57eaffd4" title="UnitTesting.SharedLibrary.\lWrappers.MongoDB.TestMongoDBWrapper.\lIsValidCategory" alt="" coords="303,5,584,61"/>
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af9e4883a361fb482a04cd6c389a5e7f9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.PopulateAppsUpdaterQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare the queue for AppsUpdater. This method should run once per day. </p>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l01057">1057</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="preprocessor">            #region REGION:  DECLARE VARIABLES AND INSTANCES</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <span class="keywordtype">int</span> nQueued = 0;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            List&lt;string&gt; response;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            List&lt;QueuedApp&gt; wBuffer = <span class="keyword">new</span> List&lt;QueuedApp&gt;();</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="preprocessor">            #region REGION:  QUERY A</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <span class="comment">// Select all not already updated today from APPS_DATA_COLLECTION</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            response = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                .Find(x =&gt; x.refdate != <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow.Date)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                .Project(x =&gt; x._id)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                .ToList();</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="preprocessor">            #region REGION:  ENQUEUE</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            <span class="comment">// Add all apps of the category to QueuedGames. If wasn&#39;t already updated today or is already queued.</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            <span class="keywordflow">foreach</span> (<span class="keywordtype">string</span> appUrl <span class="keywordflow">in</span> response)</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                wBuffer.Add (<span class="keyword">new</span> <a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>(appUrl));</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                nQueued++;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                <span class="comment">// Is buffer full? -&gt; Write and clean.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                <span class="keywordflow">if</span> (wBuffer.Count &gt;= Constants.BUFFER_SIZE)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                {</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                        Constants.APPS_UPDATER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                    wBuffer.Clear ();</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            }</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            <span class="keywordflow">if</span> (wBuffer.Count &gt; 0) </div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                    Constants.APPS_UPDATER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="comment">// Feedback</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Info(nQueued + <span class="stringliteral">&quot; Documents added to Apps Updater Queue.&quot;</span>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html">SharedLibrary.Models.QueuedApp</a></div><div class="ttdoc">A queued app, waiting to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00009">QueuedApp.cs:9</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_ad0bc39024902aad8a088397b76a45a84"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertMany</a></div><div class="ttdeci">void InsertMany(IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</div><div class="ttdoc">Inserts a bulk of elements to the MongoDB. The type T must match the type of the target collection ...</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00232">MongoDBWrapper.cs:232</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">SharedLibrary.Wrappers.MongoDB.DateType.DateTime</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_app_model_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_app_model.html">SharedLibrary.Models.AppModel</a></div><div class="ttdoc">An app from GooglePlay. </div><div class="ttdef"><b>Definition:</b> <a href="_app_model_8cs_source.html#l00012">AppModel.cs:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a767610cfcffc13d0c1fb574326e800d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.PopulateDailyScraperQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>BUG: Right now the <a class="el" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html" title="Wrappers of MongoDB.Driver class. Performs DB operations. ">MongoDB</a> drivers doesn't support auto pooling, so it will result in exceptions if maxpoolsize is exceeded. This is dangerous because our collection size is not fixed. We can use async when they fix it. So i'll leave this method here as example. The adventage of doing this async is that the operations will not lock the db for the rest of users. More info: <a href="https://jira.mongodb.org/browse/CSHARP-1180">https://jira.mongodb.org/browse/CSHARP-1180</a> </p>
<p>Prepare the queue for DailyScrapper. This method should run once per day. </p>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00927">927</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">            #region REGION:  DECLARE VARIABLES AND INSTANCES</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keywordtype">int</span> nQueued    = 0;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="keywordtype">bool</span> catsEnabled = (Constants.VALID_CATEGORIES != null) || </div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                Constants.VALID_CATEGORIES.Any();</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            List&lt;string&gt; response;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            List&lt;string&gt; response2;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            List&lt;QueuedApp&gt; wBuffer = <span class="keyword">new</span> List&lt;QueuedApp&gt;();</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">            #region REGION:  QUERY A</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="comment">// Select all from APPS_DATA_COLLECTION</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="keywordflow">if</span> (catsEnabled)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                response = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                    Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                    .Find(Builders&lt;AppModel&gt;.Filter.In(</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                        <span class="stringliteral">&quot;cat&quot;</span>, Constants.VALID_CATEGORIES))</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                    .Project(x =&gt; x._id)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                    .ToList();</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                response =  <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                    Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                    .Find(<span class="keyword">new</span> BsonDocument())</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                    .Project(x =&gt; x._id)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                    .ToList();</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">            #region REGION:  QUERY B</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="comment">// Select all urls from DAILY_DATA_COLLECTION that have been already updated today.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            response2 = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>&gt;(</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                .Find(</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                    Builders&lt;QueuedApp&gt;.Filter</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                    .Gte(<span class="stringliteral">&quot;refDate&quot;</span>, <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow.Date) &amp; </div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                    Builders&lt;QueuedApp&gt;.Filter</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                    .Lt(<span class="stringliteral">&quot;refDate&quot;</span>, <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow.Date.AddDays(1)))</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                .Project(x =&gt; x._id)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                .ToList();</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">            #region REGION:  FILTER RESPONSES</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            <span class="comment">// Remove all urls from response2 in response 1</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            response = response.Except(response2).ToList();</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="preprocessor">            #region REGION:  ENQUEUE</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">foreach</span> (var appUrl <span class="keywordflow">in</span> response)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                wBuffer.Add (<span class="keyword">new</span> <a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>(appUrl));</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                nQueued++;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                <span class="keywordflow">if</span> (wBuffer.Count &gt;= Constants.BUFFER_SIZE)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        Constants.DAILY_SCRAPER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                    wBuffer.Clear ();</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                }</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            }</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="comment">// Odd buffer size? Write remaining apps.</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <span class="keywordflow">if</span> (wBuffer.Count &gt; 0)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                    Constants.DAILY_SCRAPER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="comment">// Feedback</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Info(nQueued + <span class="stringliteral">&quot; Documents added to Daily Scrapper Queue.&quot;</span>);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html">SharedLibrary.Models.QueuedApp</a></div><div class="ttdoc">A queued app, waiting to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00009">QueuedApp.cs:9</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_ad0bc39024902aad8a088397b76a45a84"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertMany</a></div><div class="ttdeci">void InsertMany(IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</div><div class="ttdoc">Inserts a bulk of elements to the MongoDB. The type T must match the type of the target collection ...</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00232">MongoDBWrapper.cs:232</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">SharedLibrary.Wrappers.MongoDB.DateType.DateTime</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_app_model_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_app_model.html">SharedLibrary.Models.AppModel</a></div><div class="ttdoc">An app from GooglePlay. </div><div class="ttdef"><b>Definition:</b> <a href="_app_model_8cs_source.html#l00012">AppModel.cs:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a184e67222e5ae0501cb3f8338e8e0676"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.PopulateHPDailyScraperQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare the queue for DailyScrapper when client is running in hp-mode. This method can run more than once per day. </p>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l01001">1001</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">            #region REGION:  DECLARE VARIABLES AND INSTANCES</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordtype">int</span> nQueued      = 0;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="keywordtype">bool</span> catsEnabled = (Constants.VALID_CATEGORIES != null) || </div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                Constants.VALID_CATEGORIES.Any();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            List&lt;string&gt; response;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            List&lt;QueuedApp&gt; wBuffer = <span class="keyword">new</span> List&lt;QueuedApp&gt;();</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="preprocessor">            #region REGION:  QUERY A</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="comment">// Select all popular apps from APPS_DATA_COLLECTION</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            <span class="keywordflow">if</span> (catsEnabled)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                response = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                    .Find(Builders&lt;AppModel&gt;.Filter.In(</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                        <span class="stringliteral">&quot;cat&quot;</span>, Constants.VALID_CATEGORIES) &amp;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                        Builders&lt;AppModel&gt;.Filter.Gte(<span class="stringliteral">&quot;instmin&quot;</span>, 100000000))</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                    .Project(x =&gt; x._id)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                    .ToList();</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                response =  <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                    .Find(Builders&lt;AppModel&gt;.Filter.Gte(<span class="stringliteral">&quot;instmin&quot;</span>, 100000000))</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    .Project(x =&gt; x._id)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    .ToList();</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">            #region REGION:  ENQUEUE</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordflow">foreach</span> (var appUrl <span class="keywordflow">in</span> response)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                wBuffer.Add (<span class="keyword">new</span> <a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>(appUrl));</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                nQueued++;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                <span class="keywordflow">if</span> (wBuffer.Count &gt;= Constants.BUFFER_SIZE)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        Constants.HP_DAILY_SCRAPER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                    wBuffer.Clear ();</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <span class="comment">// Odd buffer size? Write remaining apps.</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="keywordflow">if</span> (wBuffer.Count &gt; 0)</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                    Constants.HP_DAILY_SCRAPER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="comment">// Feedback</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Info(nQueued + <span class="stringliteral">&quot; Documents added to High Priority Daily Scrapper Queue.&quot;</span>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html">SharedLibrary.Models.QueuedApp</a></div><div class="ttdoc">A queued app, waiting to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00009">QueuedApp.cs:9</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_ad0bc39024902aad8a088397b76a45a84"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertMany</a></div><div class="ttdeci">void InsertMany(IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</div><div class="ttdoc">Inserts a bulk of elements to the MongoDB. The type T must match the type of the target collection ...</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00232">MongoDBWrapper.cs:232</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_app_model_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_app_model.html">SharedLibrary.Models.AppModel</a></div><div class="ttdoc">An app from GooglePlay. </div><div class="ttdef"><b>Definition:</b> <a href="_app_model_8cs_source.html#l00012">AppModel.cs:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a569fb0aa7d0cfcfc61426377615d0600"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.PopulateQueuedForClean </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare the queue for AppsCleaner. This method should run once per day. </p>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l01103">1103</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">            #region REGION:  DECLARE VARIABLES AND INSTANCES</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            <span class="keywordtype">int</span> nQueued = 0;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            List&lt;string&gt; response;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            List&lt;QueuedApp&gt; wBuffer = <span class="keyword">new</span> List&lt;QueuedApp&gt;();</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="preprocessor">            #region REGION:  QUERY A</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="comment">// Find all apps.</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            response = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;<a class="code" href="class_shared_library_1_1_models_1_1_app_model.html">AppModel</a>&gt;(</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                Constants.APPS_DATA_COLLECTION)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                .Find(<span class="keyword">new</span> BsonDocument())</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                .Project(x =&gt; x._id)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                .ToList();</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="preprocessor">            #region REGION:  ENQUEUE</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="comment">// Add all apps of the category to QueuedGames. If wasn&#39;t already updated today or is already queued.</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            <span class="keywordflow">foreach</span> (var appUrl <span class="keywordflow">in</span> response)</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                wBuffer.Add(<span class="keyword">new</span> <a class="code" href="class_shared_library_1_1_models_1_1_queued_app.html">QueuedApp</a>(appUrl));</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                nQueued++;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                <span class="comment">// Is buffer full? -&gt; Write and clean.</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                <span class="keywordflow">if</span> (wBuffer.Count &gt;= Constants.BUFFER_SIZE)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                        Constants.APPS_CLEANER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                    wBuffer.Clear ();</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="comment">// Odd buffer size? Write remaining apps.</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            <span class="keywordflow">if</span> (wBuffer.Count &gt; 0) </div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">InsertMany</a>(wBuffer,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                    Constants.APPS_CLEANER_QUEUE_COLLECTION, <span class="keyword">true</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="preprocessor">            #endregion</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            <span class="comment">// Feedback</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Info(nQueued + <span class="stringliteral">&quot; Documents added to Apps Cleaner Queue.&quot;</span>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        }</div><div class="ttc" id="class_shared_library_1_1_models_1_1_queued_app_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_queued_app.html">SharedLibrary.Models.QueuedApp</a></div><div class="ttdoc">A queued app, waiting to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="_queued_app_8cs_source.html#l00009">QueuedApp.cs:9</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_ad0bc39024902aad8a088397b76a45a84"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#ad0bc39024902aad8a088397b76a45a84">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.InsertMany</a></div><div class="ttdeci">void InsertMany(IEnumerable records, string collectionName, bool ignoreDupKeys=false, bool replace=false)</div><div class="ttdoc">Inserts a bulk of elements to the MongoDB. The type T must match the type of the target collection ...</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00232">MongoDBWrapper.cs:232</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="class_shared_library_1_1_models_1_1_app_model_html"><div class="ttname"><a href="class_shared_library_1_1_models_1_1_app_model.html">SharedLibrary.Models.AppModel</a></div><div class="ttdoc">An app from GooglePlay. </div><div class="ttdef"><b>Definition:</b> <a href="_app_model_8cs_source.html#l00012">AppModel.cs:12</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a838c20ea897a9e49a8ea2223b3679628"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.UpdateTopFlags </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>country</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">List&lt; string &gt;&#160;</td>
          <td class="paramname"><em>records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">List&lt; int &gt;&#160;</td>
          <td class="paramname"><em>appsRankPos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>updateField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>collectionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isUpsert</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>It performs many updateOne operations in bulk, to update the flags of a top ranking numerating them by order. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">country</td><td>Country.</td></tr>
    <tr><td class="paramname">records</td><td>Records.</td></tr>
    <tr><td class="paramname">appsRankPos</td><td>Position in the ranking of each record. Every item corresponds to a record, in the same order.</td></tr>
    <tr><td class="paramname">updateField</td><td>Update field.</td></tr>
    <tr><td class="paramname">collectionName</td><td>Collection name.</td></tr>
    <tr><td class="paramname">isUpsert</td><td>if true, all operations will be upsert.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00698">698</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            var builder          = Builders&lt;BsonDocument&gt;.Filter;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            var collection       = <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">db</a>.GetCollection&lt;BsonDocument&gt;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                (collectionName);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            UpdateDefinition&lt;BsonDocument&gt; update;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            FilterDefinition&lt;BsonDocument&gt; filter = null;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            BulkWriteOptions options = <span class="keyword">new</span> BulkWriteOptions ();</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            var bulkOps = <span class="keyword">new</span> List&lt;WriteModel&lt;BsonDocument&gt;&gt;();</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="keywordtype">bool</span> connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordtype">int</span> nConnectionError = 0;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">do</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                <span class="keywordflow">try</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                    <span class="keywordtype">int</span> index = 0;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="preprocessor">                    #region REGION:  MONGO QUERY</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                    <span class="comment">/* For each app and country, get today&#39;s record and update </span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">                     * the indicated field. */</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    <span class="keywordflow">foreach</span>(<span class="keywordtype">string</span> url <span class="keywordflow">in</span> records)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                    {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                        <span class="comment">// Filter</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                        filter = (builder.Gte(<span class="stringliteral">&quot;_id&quot;</span>, <span class="keyword">new</span> <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">ObjectId</a> (<a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow.Date,0,0,0)) &amp;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                  builder.Lt(<span class="stringliteral">&quot;_id&quot;</span>, <span class="keyword">new</span> <a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">ObjectId</a> (<a class="code" href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">DateTime</a>.UtcNow.Date.AddDays(1),0,0,0))) &amp;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                  builder.Eq(<span class="stringliteral">&quot;country&quot;</span>, country) &amp;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                  builder.Eq(<span class="stringliteral">&quot;url&quot;</span>, url);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                        <span class="comment">// Add bulk operations</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                        update = Builders&lt;BsonDocument&gt;.Update.Set(updateField, appsRankPos[index]);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                        <span class="keywordflow">if</span> (isUpsert)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                            bulkOps.Add(<span class="keyword">new</span> UpdateOneModel&lt;BsonDocument&gt;(</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                filter, update) { IsUpsert = <span class="keyword">true</span> });</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                            bulkOps.Add(<span class="keyword">new</span> UpdateOneModel&lt;BsonDocument&gt;(</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                filter, update) { IsUpsert = <span class="keyword">false</span> });</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                        index++;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                    }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    <span class="comment">// Execute</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    options.IsOrdered = <span class="keyword">false</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    collection</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                        .WithWriteConcern(WriteConcern.Unacknowledged)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                        .BulkWrite(bulkOps, options);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="preprocessor">                    #endregion</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                    connectionError = <span class="keyword">false</span>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    Globals.MONGODB_CONNECTION_ERROR_FLAG = <span class="keyword">false</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                <span class="keywordflow">catch</span> (Exception e) when (e is MongoConnectionException || </div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.IO.EndOfStreamException ||</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                    e is <a class="code" href="namespace_system.html">System</a>.Net.Sockets.SocketException)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    <span class="comment">// Send email if too many consecutive errors.</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    connectionError = <span class="keyword">true</span>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                    nConnectionError++;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                    Thread.Sleep (Constants.MONGO_WAIT_ON_CONNECTION_ERROR);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                    <span class="keywordflow">if</span> (nConnectionError &gt;=</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        Constants.MAX_MONGODB_CONNECTION_ERROR)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                    {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                        <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Warn(Constants.MONGODB_CONNECTION_ERROR);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        ExceptionCallback.SendError (</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                            Constants.MONGODB_CONNECTION_ERROR,</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                            ref Globals.MONGODB_CONNECTION_ERROR_FLAG);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    }           </div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">catch</span>(Exception e)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                    <span class="comment">// Stop the program on unexpected error.</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                    <a class="code" href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">logger</a>.Error (</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                    ExceptionCallback.SendError (</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                        Constants.MONGODB_UNEXPECTED_ERROR + e);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                    Environment.Exit(0);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <span class="keywordflow">while</span>(connectionError);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        }</div><div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a07f343857ade196f6659dc124cd951e7">SharedLibrary.Wrappers.MongoDB.DateType.ObjectId</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a7206c640ac6ddd1b7d021c128c2d97cd"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a7206c640ac6ddd1b7d021c128c2d97cd">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</a></div><div class="ttdeci">IMongoDatabase db</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00026">MongoDBWrapper.cs:26</a></div></div>
<div class="ttc" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_html_a1177a86b12c89bdfa8999ed40181f502"><div class="ttname"><a href="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper.html#a1177a86b12c89bdfa8999ed40181f502">SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger</a></div><div class="ttdeci">readonly Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="_mongo_d_b_wrapper_8cs_source.html#l00027">MongoDBWrapper.cs:27</a></div></div>
<div class="ttc" id="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b_html_a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e"><div class="ttname"><a href="namespace_shared_library_1_1_wrappers_1_1_mongo_d_b.html#a40a0a27998a3732f6f5839b91ffbdb93a8cf10d2341ed01492506085688270c1e">SharedLibrary.Wrappers.MongoDB.DateType.DateTime</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a838c20ea897a9e49a8ea2223b3679628_cgraph.png" border="0" usemap="#class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a838c20ea897a9e49a8ea2223b3679628_cgraph" alt=""/></div>
<map name="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a838c20ea897a9e49a8ea2223b3679628_cgraph" id="class_shared_library_1_1_wrappers_1_1_mongo_d_b_1_1_mongo_d_b_wrapper_a838c20ea897a9e49a8ea2223b3679628_cgraph">
<area shape="rect" id="node2" href="class_shared_library_1_1_exception_callback.html#aac4c08013df130611a62a19c6233003d" title="It Sends an email to the administrator. " alt="" coords="305,5,524,47"/>
<area shape="rect" id="node3" href="class_shared_library_1_1_wrappers_1_1_email_management_1_1_s_m_t_p.html#ab395843cd4b16b53dcb464fce27c0b95" title="Send an email from bypassing SSL security. Only for testing pourposes. " alt="" coords="572,5,863,47"/>
</map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="acdec2ef988eddf8df22445e3df2aa2dd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.connString</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00024">24</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a7206c640ac6ddd1b7d021c128c2d97cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">IMongoDatabase SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.db</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00026">26</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a1177a86b12c89bdfa8999ed40181f502"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">readonly Logger SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.logger = LogManager.GetCurrentClassLogger ()</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00027">27</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a04f049b230d7cd97190404ea3d29c46b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MongoClient SharedLibrary.Wrappers.MongoDB.MongoDBWrapper.mongoClient</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_mongo_d_b_wrapper_8cs_source.html#l00025">25</a> of file <a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/zeioth/workspaces/csharp/GooglePlayTools/GooglePlayTools/SharedLibrary/Wrappers (Business rules)/<a class="el" href="_mongo_d_b_wrapper_8cs_source.html">MongoDBWrapper.cs</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Sat Apr 23 2016 06:32:41 for Google Play Tools by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>